"use strict";var formioBaseUrl="http://localhost:3000/app/api",boardmanAPI="http://boardman.localhost:3000/app/api";angular.module("boardmanApp",["formio","ui.router","ngMap"]).filter("ucfirst",[function(){return function(a){return a.charAt(0).toUpperCase()+a.substring(1)}}]).provider("Resource",["$stateProvider",function(a){var b={};return{register:function(c){b[c]=c;var d=c+"Form";a.state(c+"Index",{url:"/"+c,templateUrl:"views/resource/index.html",controller:["$scope","$state",function(a,b){a.resourceName=c,a.resourceForm=a[d],a.$on("submissionView",function(a,d){b.go(c+".view",{id:d._id})}),a.$on("submissionEdit",function(a,d){b.go(c+".edit",{id:d._id})}),a.$on("submissionDelete",function(a,d){b.go(c+".delete",{id:d._id})})}]}).state(c+"Create",{url:"/create/"+c,templateUrl:"views/resource/create.html",controller:["$scope","$state",function(a,b){a.resourceForm=a[d],a.$on("formSubmission",function(a,d){b.go(c+".view",{id:d._id})})}]}).state(c,{"abstract":!0,url:"/"+c+"/:id",templateUrl:"views/resource.html",controller:["$scope","$stateParams",function(a,b){a.resourceName=c,a.resourceForm=a[d],a.resourceUrl=a.resourceForm+"/submission/"+b.id}]}).state(c+".view",{url:"/",parent:c,templateUrl:"views/"+c+"/view.html",controller:["$scope","$stateParams","Formio",function(a,b,c){a.resource={},a.position={lat:"40.74",lng:"-74.18"},new c(a.resourceUrl).loadSubmission().then(function(b){b.data.address&&(a.position.lat=b.data.address.geometry.location.lat,a.position.lng=b.data.address.geometry.location.lng),a.resource=b})}]}).state(c+".edit",{url:"/edit",parent:c,templateUrl:"views/resource/edit.html",controller:["$scope","$state",function(a,b){a.$on("formSubmission",function(a,d){b.go(c+".view",{id:d._id})})}]}).state(c+".delete",{url:"/delete",parent:c,templateUrl:"views/resource/delete.html",controller:["$scope","$state",function(a,b){a.$on("delete",function(){b.go(c+"Index")})}]})},$get:function(){return b}}}]).config(["FormioProvider","ResourceProvider","$stateProvider","$urlRouterProvider",function(a,b,c,d){a.setBaseUrl(formioBaseUrl),c.state("home",{url:"/?",templateUrl:"views/main.html",controller:["$scope","$rootScope",function(a,b){a.contracts=[],a.contractsUrl=b.contractForm+"/submission",a.customers=[],a.customersUrl=b.customerForm+"/submission",a.opportunities=[],a.opportunitiesUrl=b.opportunityForm+"/submission"}]}).state("auth",{"abstract":!0,url:"/auth",templateUrl:"views/user/auth.html"}).state("auth.login",{url:"/login",parent:"auth",templateUrl:"views/user/login.html",controller:["$scope","$state","$rootScope",function(a,b,c){a.$on("formSubmission",function(a,d){d&&(c.user=d,b.go("home"))})}]}),b.register("contract"),b.register("customer"),b.register("opportunity"),b.register("agent"),d.otherwise("/")}]).factory("FormioAlerts",["$rootScope",function(a){var b=[];return{addAlert:function(c){a.alerts.push(c),c.element?angular.element("#form-group-"+c.element).addClass("has-error"):b.push(c)},getAlerts:function(){var a=angular.copy(b);return b.length=0,b=[],a},onError:function c(a){if(a.message)this.addAlert({type:"danger",message:a.message,element:a.path});else{var b=a.hasOwnProperty("errors")?a.errors:a.data.errors;angular.forEach(b,c.bind(this))}}}}]).run(["$rootScope","$state","Formio","FormioAlerts",function(a,b,c,d){a.baseUrl=formioBaseUrl,a.contractForm=boardmanAPI+"/contract",a.customerForm=boardmanAPI+"/customer",a.opportunityForm=boardmanAPI+"/opportunity",a.userLoginForm=boardmanAPI+"/agent/login",a.user||c.currentUser().then(function(b){a.user=b}),c.onLogout.then(function(){b.go("auth.login")},function(){b.go("auth.login"),d.addAlert({type:"danger",message:"Your session has expired. Please log in again."})}),a.logout=function(){c.logout(),c.setToken(null),c.setUser(null),b.go("auth.login")},a.isActive=function(a){return-1!==b.current.name.indexOf(a)},a.$on("$stateChangeStart",function(d,e){a.authenticated=!!c.getToken(),"auth"!==e.name.substr(0,4)&&(a.authenticated||(d.preventDefault(),b.go("auth.login")))}),a.$on("$stateChangeSuccess",function(){a.alerts=d.getAlerts()})}]);