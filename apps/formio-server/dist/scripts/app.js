"use strict";angular.module("formioApp",["ngSanitize","ngAnimate","restangular","ui.router","ui.bootstrap.alert","ui.bootstrap.tpls","ui.select","angularMoment","formioApp.controllers","formioApp.services","formioApp.directives"]).config(["$stateProvider","$urlRouterProvider","FormioProvider","RestangularProvider","AppConfig",function(e,r,o,t,n){o.setBaseUrl(n.apiBase),t.setBaseUrl(n.apiBase),e.state("home",{url:"/?",templateUrl:"views/home/home.html",controller:"HomeController"}).state("auth",{"abstract":!0,url:"/auth",templateUrl:"views/user/auth.html"}).state("auth.login",{url:"/login",parent:"auth",templateUrl:"views/user/login.html",controller:"UserLoginController"}).state("auth.register",{url:"/register",parent:"auth",templateUrl:"views/user/register.html",controller:"UserRegisterController"}).state("profile",{"abstract":!0,url:"/profile",templateUrl:"views/user/profile/profile.html"}).state("profile.view",{url:"/view",parent:"profile",templateUrl:"views/user/profile/profile-view.html"}).state("profile.edit",{url:"/edit",parent:"profile",templateUrl:"views/user/profile/profile-edit.html"}).state("app",{url:"/app/:appId",controller:"AppController",templateUrl:"views/app/app.html"}).state("app.create",{url:"/create/app",templateUrl:"views/app/app-form.html",controller:"AppCreateController"}).state("app.view",{url:"/view",parent:"app",templateUrl:"views/app/view.html"}).state("app.edit",{url:"/edit",parent:"app",templateUrl:"views/app/app-form.html",controller:"AppEditController"}).state("app.delete",{url:"/delete",parent:"app",templateUrl:"views/app/delete.html",controller:"AppDeleteController"}).state("importExport",{url:"/import-export",templateUrl:"views/import/index.html",controller:"ImportExportController"}).state("help",{url:"/help",templateUrl:"views/help/index.html",controller:"HelpIndexController"}),r.otherwise("/")}]).controller("HomeController",["$scope","$rootScope","Formio",function(e,r,o){r.activeSideBar="home",r.currentApp=null,e.apps={},o.loadApps().then(function(r){e.apps=r})}]).filter("trusted",["$sce",function(e){return function(r){return e.trustAsResourceUrl(r)}}]).run(["$state","$stateParams","$rootScope","FormioAlerts","Formio",function(e,r,o,t,n){o.formioAppUrl="/app/553a40b9174a9d18bb566beb",o.userForm="/app/553a40b9174a9d18bb566beb/resource/553a4114174a9d18bb566bec",o.userLoginForm="/app/553a40b9174a9d18bb566beb/form/553a5799ab352f11dddb0f30",o.userRegisterForm="/app/553a40b9174a9d18bb566beb/form/553a57eeab352f11dddb0f31",e.go("home"),o.user||n.currentUser().then(function(e){o.user=e}),o.alerts=[],o.closeAlert=function(e){o.alerts.splice(e,1)},o.$state=e,o.$stateParams=r,o.$on("$stateChangeSuccess",function(e,r,n,a,s){o.alerts=t.getAlerts(),o.previousState=a.name,o.previousParams=s,o.currentState=r.name}),o.logout=function(){n.logout().then(function(){e.go("auth.login")},t.onError.bind(t))},o.$on("$stateChangeStart",function(r,t){o.authenticated=!!n.getToken(),"auth"!==t.name.substr(0,4)&&(o.authenticated||(r.preventDefault(),e.go("auth.login")))}),o.activeSideBar="apps",o.isActive=function(r){return-1!==e.current.name.indexOf(r)},o.back=function(){e.go(o.previousState,o.previousParams)}}]),angular.module("formioApp.directives",[]).directive("logo",function(){return{restrict:"E",scope:{size:"@"},templateUrl:"views/partials/logo.html"}});var app=angular.module("formioApp.controllers.app",[]);app.controller("AppIndexController",["$scope","$rootScope","Restangular",function(e,r,o){r.noBreadcrumb=!1,r.currentApp=!1,e.apps=o.all("app").getList().$object}]),app.controller("AppCreateController",["$scope","$rootScope","$state","Restangular","FormioAlerts",function(e,r,o,t,n){r.noBreadcrumb=!1,e.currentApp={},e.saveApplication=function(){t.all("app").post(e.currentApp).then(function(e){n.addAlert({type:"success",message:"New application created!"}),o.go("app.view",{appId:e._id})},n.onError.bind(n))}}]),app.controller("AppController",["$scope","$rootScope","$stateParams","Restangular",function(e,r,o,t){r.activeSideBar="apps",r.noBreadcrumb=!1,e.currentApp={_id:o.appId},t.one("app",o.appId).get().then(function(o){e.currentApp=o,r.currentApp=o})}]),app.controller("AppEditController",["$scope","$rootScope","$state","Restangular","FormioAlerts",function(e,r,o,t,n){r.noBreadcrumb=!1,e.saveApplication=function(){return e.currentApp?void e.currentApp.save().then(function(){n.addAlert({type:"success",message:"Application saved."}),o.go("home")},n.onError.bind(n)):n.onError(new Error("No application found."))}}]),app.controller("AppDeleteController",["$scope","$state","Restangular","FormioAlerts",function(e,r,o,t){e.deleteApp=function(){e.currentApp&&e.currentApp._id&&o.one("app",e.currentApp._id).remove().then(function(){t.addAlert({type:"success",message:"Application was deleted!"}),r.go("home")},t.onError.bind(t))}}]),angular.module("formioApp.controllers",["formioApp.controllers.resource","formioApp.controllers.app","formioApp.controllers.user","formioApp.controllers.import","formioApp.controllers.help"]).config(["ResourceProvider",function(e){e.register({title:"Form",name:"form",url:"/form",views:{create:"views/form/form.html",edit:"views/form/form.html"}}),e.register({title:"Resource",name:"resource",url:"/resource",views:{create:"views/resource/resource.html",edit:"views/resource/resource.html"}})}]);var app=angular.module("formioApp.controllers.help",[]);app.controller("HelpIndexController",["$scope","$rootScope",function(e,r){r.activeSideBar="help",r.noBreadcrumb=!0}]);var app=angular.module("formioApp.controllers.import",[]);app.controller("ImportExportController",["$scope","$rootScope",function(e,r){r.activeSideBar="import",r.noBreadcrumb=!0}]);var app=angular.module("formioApp.controllers.resource",["ngDialog","ui.sortable","ui.bootstrap.tabs","ui.bootstrap.tpls","ui.bootstrap.accordion","ngFormBuilder","formio","bgf.paginateAnything"]);app.provider("Resource",["$stateProvider","RestangularProvider",function(e,r){var o={};return r.setRestangularFields({id:"_id"}),{register:function(r){var t=" resource-title=\"'"+r.title+"'\"";t+=" resource-name=\"'"+r.name+"'\"",o[r.name]=r;var n="app."+r.name;e.state(n,{"abstract":!0,url:r.url+"/:id",parent:"app",templateUrl:"views/resource/resource-root.html",controller:"ResourceController",params:{resourceInfo:r}}).state(n+".view",{url:"",parent:n,templateUrl:"views/resource/resource-view.html",controller:"ResourceViewController"}).state(n+".edit",{url:"/edit",parent:n,templateUrl:"views/resource/resource-edit.html"}).state(n+".delete",{url:"/delete",parent:n,templateUrl:"views/resource/resource-delete.html",controller:"ResourceDeleteController"}).state(n+".create",{url:"/create/"+r.name,parent:"app",templateUrl:"views/resource/resource-create.html",controller:"ResourceController",params:{resourceInfo:r}}).state(n+".index",{url:r.url,parent:"app",template:"<resource-list"+t+"></resource-list>"}).state(n+".api",{url:"/api",parent:n,templateUrl:"views/resource/resource-api.html",controller:"ResourceAPIController"}).state(n+".api.spec",{url:"/spec",parent:n+".api",templateUrl:"views/resource/resource-api.spec.html",controller:"ResourceAPISpecController"}).state(n+".api.embed",{url:"/embed",parent:n+".api",templateUrl:"views/resource/resource-api.embed.html"});var a={};a[n+".submission"]={path:"/submission",id:"subId",indexController:"ResourceSubmissionsController",itemController:"ResourceSubmissionController",editController:"ResourceSubmissionEditController",deleteController:"ResourceSubmissionDeleteController"},a[n+".action"]={path:"/action",id:"actionId",enabled:{view:!1},indexController:"ResourceActionIndexController",editController:"ResourceActionEditController",deleteController:"ResourceActionDeleteController"},angular.forEach(a,function(r,o){e.state(o,{"abstract":!0,url:r.path,parent:n,template:"<div ui-view></div>"}).state(o+".index",{url:"",parent:o,templateUrl:"views/resource"+r.path+"/index.html",controller:r.indexController}).state(o+".item",{"abstract":!0,url:"/:"+r.id,parent:o,controller:r.itemController,templateUrl:"views/resource"+r.path+"/item.html"}).state(o+".item.view",{url:"",parent:o+".item",templateUrl:"views/resource"+r.path+"/view.html",controller:r.viewController}).state(o+".item.edit",{url:"/edit",parent:o+".item",templateUrl:"views/resource"+r.path+"/edit.html",controller:r.editController}).state(o+".item.delete",{url:"/delete",parent:o+".item",templateUrl:"views/resource"+r.path+"/delete.html",controller:r.deleteController})}),e.state(n+".action.add",{url:"/add/:actionName",parent:n+".action",templateUrl:"views/resource/action/add.html",controller:"ResourceActionAddController",params:{actionInfo:null}})},$get:function(){return o}}}]),app.factory("FormioAlerts",["$rootScope",function(e){var r=[];return{addAlert:function(o){e.alerts.push(o),o.element?angular.element("#form-group-"+o.element).addClass("has-error"):r.push(o)},getAlerts:function(){var e=angular.copy(r);return r.length=0,r=[],e},onError:function(e){var r=e.hasOwnProperty("errors")?e.errors:e.data.errors;_.each(r,function(e){this.addAlert({type:"danger",message:e.message,element:e.path})}.bind(this))}}}]),app.directive("resourceList",function(){return{restrict:"E",replace:!0,templateUrl:"views/resource/resource-list.html",scope:{app:"=",resourceTitle:"=",resourceName:"=",numPerPage:"="},compile:function(e,r){r.numPerPage||(r.numPerPage=25),r.resourceTitle||(r.resourceTitle="Resource"),r.resourceName||(r.resourceName="resource")},controller:["$scope","$rootScope","Restangular",function(e,r,o){r.activeSideBar="apps",r.noBreadcrumb=!1,e.resources=[],e.resourcesPerPage=e.numPerPage,e.resourceUrl=o.one("app",e.app._id).all(e.resourceName).getRestangularUrl(),e.resourceInfo={title:e.resourceTitle,name:e.resourceName}}]}});var formioResourceScope=function(e,r,o,t,n){var a=function(e){return e.toLowerCase().replace(/ (.)/g,function(e,r){return r.toUpperCase()})};e.appId=o.appId,e.resourceId=o.id,e.resourceName=o.resourceInfo.name,e.resourceUrl="/app/"+o.appId+"/"+o.resourceInfo.name,e.resourceUrl+=o.id?"/"+o.id:"",e.resourceInfo=o.resourceInfo,e.resource={title:"",components:[]},e.$watch("resource.title",function(){e.resource.name=e.resource.title?a(e.resource.title):""}),e.formio=new t(e.resourceUrl),e.formio.loadForm().then(function(r){e.resource=r}),e.saveResource=function(){e.formio.saveForm(e.resource).then(function(e){n.addAlert({type:"success",message:"Successfully created form!"}),r.go("app."+o.resourceInfo.name+".view",{id:e._id})},n.onError.bind(n))}};app.controller("ResourceController",["$scope","$state","$stateParams","Formio","FormioAlerts",formioResourceScope]),app.controller("ResourceViewController",["$scope","$state","FormioAlerts",function(e,r,o){e.$on("formSubmission",function(t,n){o.addAlert({type:"success",message:"New submission added!"}),n._id&&r.go("app."+e.resourceInfo.name+".submission.item.view",{subId:n._id})})}]),app.controller("ResourceDeleteController",["$scope","$state","Formio","FormioAlerts",function(e,r,o,t){e.deleteResource=function(){e.formio.deleteForm().then(function(){t.addAlert({type:"success",message:"Delete successfull."}),r.go("app."+e.resourceInfo.name+".index")},t.onError.bind(t))}}]),app.controller("ResourceAPIController",["$scope","$state",function(e,r){r.transitionTo("app."+e.resourceInfo.name+".api.spec",{appId:e.appId,id:e.resourceId})}]),app.controller("ResourceAPISpecController",["$scope","AppConfig",function(e,r){e.getSwaggerURL=function(){return r.appBase+"/form/"+e.resource._id+"/spec.html"}}]),app.controller("ResourceActionIndexController",["$scope","$state","Formio","FormioAlerts",function(e,r,o,t){e.newAction={name:"",title:"Select an Action"},e.availableActions={},e.actions={},e.addAction=function(){e.newAction.name?r.go("app."+e.resourceInfo.name+".action.add",{actionName:e.newAction.name,actionInfo:e.newAction}):t.addAlert({type:"danger",message:"You must add an action to continue.",element:"action-select"})},e.formio.loadActions().then(function(r){e.actions=r},t.onError.bind(t)),e.formio.availableActions().then(function(r){r[0].name||r.shift(),r.unshift(e.newAction),e.availableActions=r})}]);var loadActionInfo=function(e,r,o){e.actionPath="",e.actionInfo=r.actionInfo||{settingsForm:{}},e.action={data:{settings:{}}};var t=function(r,o){e.formio.availableActions().then(function(t){angular.forEach(t,function(t){t.name===r&&(e.actionInfo=_.merge(e.actionInfo,t),o&&o(e.actionInfo))})})},n=function(n){if(r.actionId){e.actionPath=e.formio.formPath+"/action/"+r.actionId;var a=new o(e.actionPath);a.loadAction().then(function(r){e.action=_.merge(e.action,{data:r}),t(r.name)})}else n&&(e.action=_.merge(e.action,{data:n}),e.action.data.settings={})};!r.actionInfo&&r.actionName?t(r.actionName,function(e){n(e.defaults)}):n(e.actionInfo.defaults)};app.controller("ResourceActionAddController",["$scope","$stateParams","$state","FormioAlerts",function(e,r,o,t){loadActionInfo(e,r),e.$on("formSubmission",function(){t.addAlert({type:"success",message:"Action was created."}),o.go("app."+e.resourceInfo.name+".action.index")})}]),app.controller("ResourceActionEditController",["$scope","$stateParams","$state","Formio","FormioAlerts",function(e,r,o,t,n){loadActionInfo(e,r,t),e.$on("formSubmission",function(){n.addAlert({type:"success",message:"Action was updated."}),o.go("app."+e.resourceInfo.name+".action.index")})}]),app.controller("ResourceActionDeleteController",["$scope","$stateParams","$state","FormioAlerts",function(e,r,o,t){e.actionPath=e.formio.formPath+"/action/"+r.actionId,e.$on("delete",function(){t.addAlert({type:"success",message:"Action was deleted."}),o.go("app."+e.resourceInfo.name+".action.index")})}]),app.controller("ResourceSubmissionsController",["$scope","$state",function(e,r){e.$on("submissionView",function(o,t){r.go("app."+e.resourceInfo.name+".submission.item.view",{subId:t._id})}),e.$on("submissionEdit",function(o,t){r.go("app."+e.resourceInfo.name+".submission.item.edit",{subId:t._id})}),e.$on("submissionDelete",function(o,t){r.go("app."+e.resourceInfo.name+".submission.item.delete",{subId:t._id})})}]),app.controller("ResourceSubmissionController",["$scope","$state","$stateParams","Formio",function(e,r,o,t){e.submissionId=o.subId,e.submissionUrl=e.resourceUrl,e.submissionUrl+=o.subId?"/submission/"+o.subId:"",e.submissionData=t.submissionData,e.submission={},e.formio=new t(e.submissionUrl),e.formio.loadSubmission().then(function(r){e.submission=r})}]),app.controller("ResourceSubmissionEditController",["$scope","$state","FormioAlerts",function(e,r,o){e.$on("formSubmission",function(t,n){var a="put"===n.method?"updated":"created";o.addAlert({type:"success",message:"Submission was "+a+"."}),r.go("app."+e.resourceInfo.name+".submission.index",{id:e.resourceId})}),e.deleteSubmission=function(){e.formio.deleteSubmission().then(function(){r.go("app."+e.resourceInfo.name+".submission.index",{id:e.resourceId})},o.onError.bind(o))}}]),app.controller("ResourceSubmissionDeleteController",["$scope","$state","FormioAlerts",function(e,r,o){e.$on("delete",function(){o.addAlert({type:"success",message:"Submission was deleted."}),r.go("app."+e.resourceInfo.name+".submission.index")}),e.$on("cancel",function(){r.go("app."+e.resourceInfo.name+".submission.item.view")}),e.$on("formError",function(e,r){o.onError(r)})}]);var app=angular.module("formioApp.controllers.user",[]);app.controller("UserLoginController",["$scope","$state","$rootScope",function(e,r,o){e.$on("formSubmission",function(e,t){t&&(o.user=t,r.go("home"))})}]),app.controller("UserRegisterController",["$scope","$state","$rootScope",function(e,r,o){e.$on("formSubmission",function(e,t){t&&(o.user=t,r.go("home"))})}]),angular.module("formioApp.services",[]).service("popupService",["$window",function(e){this.showPopup=function(r){return e.confirm(r)}}]);