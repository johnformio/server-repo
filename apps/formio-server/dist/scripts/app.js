"use strict";angular.module("formioApp",["ngSanitize","ngAnimate","restangular","ui.router","ui.bootstrap.alert","ui.bootstrap.tpls","ui.select","angularMoment","formioApp.controllers","formioApp.services","formioApp.directives"]).config(["$stateProvider","$urlRouterProvider","FormioProvider","RestangularProvider","AppConfig",function(e,o,r,t,n){r.setBaseUrl(n.apiBase),t.setBaseUrl(n.apiBase),e.state("home",{url:"/?",templateUrl:"views/home/home.html",controller:"HomeController"}).state("auth",{"abstract":!0,url:"/auth",templateUrl:"views/user/auth.html"}).state("auth.login",{url:"/login",parent:"auth",templateUrl:"views/user/login.html",controller:"UserLoginController"}).state("auth.register",{url:"/register",parent:"auth",templateUrl:"views/user/register.html",controller:"UserRegisterController"}).state("profile",{"abstract":!0,url:"/profile",templateUrl:"views/user/profile/profile.html"}).state("profile.view",{url:"/view",parent:"profile",templateUrl:"views/user/profile/profile-view.html"}).state("profile.edit",{url:"/edit",parent:"profile",templateUrl:"views/user/profile/profile-edit.html"}).state("app",{url:"/app/:appId",controller:"AppController",templateUrl:"views/app/app.html"}).state("app.create",{url:"/create/app",templateUrl:"views/app/app-form.html",controller:"AppCreateController"}).state("app.view",{url:"/view",parent:"app",templateUrl:"views/app/view.html"}).state("app.edit",{url:"/edit",parent:"app",templateUrl:"views/app/app-form.html",controller:"AppEditController"}).state("app.delete",{url:"/delete",parent:"app",templateUrl:"views/app/delete.html",controller:"AppDeleteController"}).state("importExport",{url:"/import-export",templateUrl:"views/import/index.html",controller:"ImportExportController"}).state("help",{url:"/help",templateUrl:"views/help/index.html",controller:"HelpIndexController"}),o.otherwise("/")}]).controller("HomeController",["$scope","$rootScope","Formio",function(e,o,r){o.activeSideBar="home",o.currentApp=null,e.apps={},r.loadApps().then(function(o){e.apps=o})}]).filter("trusted",["$sce",function(e){return function(o){return e.trustAsResourceUrl(o)}}]).run(["$state","$stateParams","$rootScope","FormioAlerts","Formio",function(e,o,r,t,n){r.formioAppUrl="/app/553a40b9174a9d18bb566beb",r.userForm="/app/553a40b9174a9d18bb566beb/resource/553a4114174a9d18bb566bec",r.userLoginForm="/app/553a40b9174a9d18bb566beb/form/553a5799ab352f11dddb0f30",r.userRegisterForm="/app/553a40b9174a9d18bb566beb/form/553a57eeab352f11dddb0f31",e.go("home"),r.user||n.currentUser().then(function(e){r.user=e}),r.alerts=[],r.closeAlert=function(e){r.alerts.splice(e,1)},r.$state=e,r.$stateParams=o,r.$on("$stateChangeSuccess",function(e,o,n,a,i){r.alerts=t.getAlerts(),r.previousState=a.name,r.previousParams=i,r.currentState=o.name}),r.logout=function(){n.logout().then(function(){e.go("auth.login")},t.onError.bind(t))},r.activeSideBar="apps",r.isActive=function(o){return-1!==e.current.name.indexOf(o)},r.back=function(){e.go(r.previousState,r.previousParams)}}]);var app=angular.module("formioApp.controllers.app",[]);app.controller("AppIndexController",["$scope","$rootScope","Restangular",function(e,o,r){o.noBreadcrumb=!1,o.currentApp=!1,e.apps=r.all("app").getList().$object}]),app.controller("AppCreateController",["$scope","$rootScope","$state","Restangular","FormioAlerts",function(e,o,r,t,n){o.noBreadcrumb=!1,e.currentApp={},e.saveApplication=function(){t.all("app").post(e.currentApp).then(function(e){n.addAlert({type:"success",message:"New application created!"}),r.go("app.view",{appId:e._id})},n.onError.bind(n))}}]),app.controller("AppController",["$scope","$rootScope","$stateParams","Restangular",function(e,o,r,t){o.activeSideBar="apps",o.noBreadcrumb=!1,e.currentApp={_id:r.appId},t.one("app",r.appId).get().then(function(r){e.currentApp=r,o.currentApp=r})}]),app.controller("AppEditController",["$scope","$rootScope","$state","Restangular","FormioAlerts",function(e,o,r,t,n){o.noBreadcrumb=!1,e.saveApplication=function(){return e.currentApp?void e.currentApp.save().then(function(){n.addAlert({type:"success",message:"Application saved."}),r.go("home")},n.onError.bind(n)):n.onError(new Error("No application found."))}}]),app.controller("AppDeleteController",["$scope","$state","Restangular","FormioAlerts",function(e,o,r,t){e.deleteApp=function(){e.currentApp&&e.currentApp._id&&r.one("app",e.currentApp._id).remove().then(function(){t.addAlert({type:"success",message:"Application was deleted!"}),o.go("home")},t.onError.bind(t))}}]),angular.module("formioApp.controllers",["formioApp.controllers.form","formioApp.controllers.app","formioApp.controllers.user","formioApp.controllers.import","formioApp.controllers.help"]);var app=angular.module("formioApp.controllers.form",["ngDialog","ui.sortable","ui.bootstrap.tabs","ui.bootstrap.tpls","ui.bootstrap.accordion","ngFormBuilder","formio","bgf.paginateAnything"]);app.config(["$stateProvider",function(e){e.state("app.form",{"abstract":!0,url:"/form/:formId",parent:"app",templateUrl:"views/form/form.html",controller:"FormController"}).state("app.form.view",{url:"",parent:"app.form",templateUrl:"views/form/form-view.html"}).state("app.form.edit",{url:"/edit",parent:"app.form",templateUrl:"views/form/form-edit.html"}).state("app.form.delete",{url:"/delete",parent:"app.form",templateUrl:"views/form/form-delete.html"}).state("app.form.createForm",{url:"/create/form",parent:"app",templateUrl:"views/form/form-edit.html",controller:"FormController",params:{formType:"form"}}).state("app.form.createResource",{url:"/create/resource",parent:"app",templateUrl:"views/form/form-edit.html",controller:"FormController",params:{formType:"resource"}}).state("app.form.formIndex",{url:"/form",parent:"app",template:'<form-list app="currentApp" form-type="\'form\'" num-per-page="25"></form-list>'}).state("app.form.resourceIndex",{url:"/form",parent:"app",template:'<form-list app="currentApp" form-type="\'resource\'" num-per-page="25"></form-list>'}).state("app.form.api",{"abstract":!0,url:"/api",parent:"app.form",templateUrl:"views/form/form-api.html"}).state("app.form.api.spec",{url:"/spec",parent:"app.form.api",templateUrl:"views/form/form-api.spec.html"}).state("app.form.api.embed",{url:"/embed",parent:"app.form.api",templateUrl:"views/form/form-api.embed.html"});var o={};o["app.form.submission"]={path:"/submission",id:"subId",indexController:"FormSubmissionsController",itemController:"FormSubmissionController",editController:"FormSubmissionEditController",deleteController:"FormSubmissionDeleteController"},o["app.form.action"]={path:"/action",id:"actionId",enabled:{view:!1},indexController:"FormActionIndexController",editController:"FormActionEditController",deleteController:"FormActionDeleteController"},angular.forEach(o,function(o,r){e.state(r,{"abstract":!0,url:o.path,parent:"app.form",template:"<div ui-view></div>"}).state(r+".index",{url:"",parent:r,templateUrl:"views/form"+o.path+"/index.html",controller:o.indexController}).state(r+".item",{"abstract":!0,url:"/:"+o.id,parent:r,controller:o.itemController,templateUrl:"views/form"+o.path+"/item.html"}).state(r+".item.view",{url:"",parent:r+".item",templateUrl:"views/form"+o.path+"/view.html",controller:o.viewController}).state(r+".item.edit",{url:"/edit",parent:r+".item",templateUrl:"views/form"+o.path+"/edit.html",controller:o.editController}).state(r+".item.delete",{url:"/delete",parent:r+".item",templateUrl:"views/form"+o.path+"/delete.html",controller:o.deleteController})}),e.state("app.form.action.add",{url:"/add/:actionName",parent:"app.form.action",templateUrl:"views/form/action/add.html",controller:"FormActionAddController",params:{actionInfo:null}})}]),app.directive("formList",function(){return{restrict:"E",replace:!0,templateUrl:"views/form/form-list.html",scope:{app:"=",formType:"=",numPerPage:"="},compile:function(e,o){o.numPerPage||(o.numPerPage=25)},controller:["$scope","$rootScope","Formio",function(e,o,r){o.activeSideBar="apps",o.noBreadcrumb=!1,e.forms=[],e.formsPerPage=e.numPerPage,e.formsUrl=r.baseUrl+"/form?type="+e.formType}]}}),app.controller("FormController",["$scope","$state","$stateParams","Formio","FormioAlerts","AppConfig",function(e,o,r,t,n,a){var i=function(e){return e.toLowerCase().replace(/ (.)/g,function(e,o){return o.toUpperCase()})};e.appId=r.appId,e.formId=r.formId,e.formUrl="/app/"+r.appId+"/form",e.formUrl+=r.formId?"/"+r.formId:"";var p=r.formType||"form";e.form={title:"",type:p,components:[]},e.$watch("form.title",function(){e.form.name=e.form.title?i(e.form.title):""}),e.formio=new t(e.formUrl),e.formio.loadForm().then(function(o){e.form=o}),e.getSwaggerURL=function(){return a.appBase+"/form/"+e.form._id+"/spec.html"},e.$on("formSubmission",function(e,r){n.addAlert({type:"success",message:"New submission added!"}),r._id&&o.go("app.form.submission.item.view",{subId:r._id})}),e.saveForm=function(){e.formio.saveForm(e.form).then(function(e){n.addAlert({type:"success",message:"Successfully created form!"}),o.go("app.form.view",{formId:e._id})},n.onError.bind(n))},e.deleteForm=function(){e.formio.deleteForm().then(function(){n.addAlert({type:"success",message:"Delete successful"}),o.go("app.form.index")},n.onError.bind(n))}}]),app.factory("FormioAlerts",["$rootScope",function(e){var o=[];return{addAlert:function(r){e.alerts.push(r),r.element?angular.element("#form-group-"+r.element).addClass("has-error"):o.push(r)},getAlerts:function(){var e=angular.copy(o);return o.length=0,o=[],e},onError:function(e){var o=e.hasOwnProperty("errors")?e.errors:e.data.errors;_.each(o,function(e){this.addAlert({type:"danger",message:e.message,element:e.path})}.bind(this))}}}]),app.controller("FormActionIndexController",["$scope","$state","Formio","FormioAlerts",function(e,o,r,t){e.newAction={name:"",title:"Select an Action"},e.availableActions={},e.actions={},e.addAction=function(){e.newAction.name?o.go("app.form.action.add",{actionName:e.newAction.name,actionInfo:e.newAction}):t.addAlert({type:"danger",message:"You must add an action to continue.",element:"action-select"})},e.formio.loadActions().then(function(o){e.actions=o},t.onError.bind(t)),e.formio.availableActions().then(function(o){o[0].name||o.shift(),o.unshift(e.newAction),e.availableActions=o})}]);var loadActionInfo=function(e,o,r){e.actionPath="",e.actionInfo=o.actionInfo||{settingsForm:{}},e.action={data:{settings:{}}};var t=function(o,r){e.formio.availableActions().then(function(t){angular.forEach(t,function(t){t.name===o&&(e.actionInfo=_.merge(e.actionInfo,t),r&&r(e.actionInfo))})})},n=function(n){if(o.actionId){e.actionPath=e.formio.formPath+"/action/"+o.actionId;var a=new r(e.actionPath);a.loadAction().then(function(o){e.action=_.merge(e.action,{data:o}),t(o.name)})}else n&&(e.action=_.merge(e.action,{data:n}),e.action.data.settings={})};!o.actionInfo&&o.actionName?t(o.actionName,function(e){n(e.defaults)}):n(e.actionInfo.defaults)};app.controller("FormActionAddController",["$scope","$stateParams","$state","FormioAlerts",function(e,o,r,t){loadActionInfo(e,o),e.$on("formSubmission",function(){t.addAlert({type:"success",message:"Action was created."}),r.go("app.form.action.index")})}]),app.controller("FormActionEditController",["$scope","$stateParams","$state","Formio","FormioAlerts",function(e,o,r,t,n){loadActionInfo(e,o,t),e.$on("formSubmission",function(){n.addAlert({type:"success",message:"Action was updated."}),r.go("app.form.action.index")})}]),app.controller("FormActionDeleteController",["$scope","$stateParams","$state","FormioAlerts",function(e,o,r,t){e.actionPath=e.formio.formPath+"/action/"+o.actionId,e.$on("delete",function(){t.addAlert({type:"success",message:"Action was deleted."}),r.go("app.form.action.index")})}]),app.controller("FormSubmissionsController",["$scope","$state",function(e,o){e.$on("submissionView",function(e,r){o.go("app.form.submission.item.view",{subId:r._id})}),e.$on("submissionEdit",function(e,r){o.go("app.form.submission.item.edit",{subId:r._id})}),e.$on("submissionDelete",function(e,r){o.go("app.form.submission.item.delete",{subId:r._id})})}]),app.controller("FormSubmissionController",["$scope","$state","$stateParams","Formio",function(e,o,r,t){e.submissionId=r.subId,e.submissionUrl=e.formUrl,e.submissionUrl+=r.subId?"/submission/"+r.subId:"",e.submissionData=t.submissionData,e.submission={},e.formio=new t(e.submissionUrl),e.formio.loadSubmission().then(function(o){e.submission=o})}]),app.controller("FormSubmissionEditController",["$scope","$state","FormioAlerts",function(e,o,r){e.$on("formSubmission",function(t,n){var a="put"===n.method?"updated":"created";r.addAlert({type:"success",message:"Submission was "+a+"."}),o.go("app.form.submission.index",{formId:e.formId})}),e.deleteSubmission=function(){e.formio.deleteSubmission().then(function(){o.go("app.form.submission.index",{formId:e.formId})},r.onError.bind(r))}}]),app.controller("FormSubmissionDeleteController",["$scope","$state","FormioAlerts",function(e,o,r){e.$on("delete",function(){r.addAlert({type:"success",message:"Submission was deleted."}),o.go("app.form.submission.index")}),e.$on("cancel",function(){o.go("app.form.submission.item.view")}),e.$on("formError",function(e,o){r.onError(o)})}]);var app=angular.module("formioApp.controllers.help",[]);app.controller("HelpIndexController",["$scope","$rootScope",function(e,o){o.activeSideBar="help",o.noBreadcrumb=!0}]);var app=angular.module("formioApp.controllers.import",[]);app.controller("ImportExportController",["$scope","$rootScope",function(e,o){o.activeSideBar="import",o.noBreadcrumb=!0}]);var app=angular.module("formioApp.controllers.user",[]);app.controller("UserLoginController",["$scope","$state","$rootScope",function(e,o,r){e.$on("formSubmission",function(e,t){t&&(r.user=t,o.go("home"))})}]),app.controller("UserRegisterController",["$scope","$state","$rootScope",function(e,o,r){e.$on("formSubmission",function(e,t){t&&(r.user=t,o.go("home"))})}]),angular.module("formioApp.directives",[]).directive("logo",function(){return{restrict:"E",scope:{size:"@"},templateUrl:"views/partials/logo.html"}}),angular.module("formioApp.services",[]).service("popupService",["$window",function(e){this.showPopup=function(o){return e.confirm(o)}}]);