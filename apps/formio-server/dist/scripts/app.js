"use strict";angular.module("formioApp",["ngSanitize","restangular","ui.router","ui.bootstrap.alert","ui.bootstrap.tpls","ui.select","angularMoment","formioApp.controllers","formioApp.services","formioApp.directives"]).config(["$stateProvider","$urlRouterProvider","FormioProvider","RestangularProvider","AppConfig",function(e,o,r,t,n){r.setBaseUrl(n.apiBase),t.setBaseUrl(n.apiBase),e.state("home",{url:"/?",templateUrl:"views/home/home.html",controller:"HomeController"}).state("app",{url:"/app/:appId",controller:"AppController",templateUrl:"views/app/app.html"}).state("app.create",{url:"/create/app",templateUrl:"views/app/create.html",controller:"AppCreateController"}).state("app.view",{url:"/view",parent:"app",templateUrl:"views/app/view.html"}).state("app.edit",{url:"/edit",parent:"app",templateUrl:"views/app/edit.html",controller:"AppEditController"}).state("app.delete",{url:"/delete",parent:"app",templateUrl:"views/app/delete.html",controller:"AppDeleteController"}).state("userIndex",{url:"/user",templateUrl:"views/user/index.html",controller:"UserIndexController"}).state("importExport",{url:"/import-export",templateUrl:"views/import/index.html",controller:"ImportExportController"}).state("help",{url:"/help",templateUrl:"views/help/index.html",controller:"HelpIndexController"}),o.otherwise("/")}]).controller("HomeController",["$scope","Restangular","$rootScope",function(e,o,r){r.activeSideBar="home",r.currentApp=null,e.apps=o.all("app").getList().$object,e.users=o.all("user").getList().$object}]).filter("trusted",["$sce",function(e){return function(o){return e.trustAsResourceUrl(o)}}]).run(["$state","$stateParams","$rootScope","FormioAlerts",function(e,o,r,t){e.go("home"),r.alerts=[],r.closeAlert=function(e){r.alerts.splice(e,1)},r.$state=e,r.$stateParams=o,r.$on("$stateChangeSuccess",function(e,o,n,s,a){r.alerts=t.getAlerts(),r.previousState=s.name,r.previousParams=a,r.currentState=o.name}),r.activeSideBar="apps",r.back=function(){e.go(r.previousState,r.previousParams)}}]);var app=angular.module("formioApp.controllers.app",[]);app.controller("AppIndexController",["$scope","$rootScope","Restangular",function(e,o,r){o.noBreadcrumb=!1,o.currentApp=!1,e.apps=r.all("app").getList().$object}]),app.controller("AppCreateController",["$scope","$rootScope","$state","Restangular","FormioAlerts",function(e,o,r,t,n){o.noBreadcrumb=!1,e.app={},e.createApplication=function(){t.all("app").post(e.app).then(function(e){n.addAlert({type:"success",message:"New application created!"}),r.go("app.view",{appId:e._id})},n.onError.bind(n))}}]),app.controller("AppController",["$scope","$rootScope","$stateParams","Restangular",function(e,o,r,t){o.activeSideBar="apps",o.noBreadcrumb=!1,e.currentApp={_id:r.appId},t.one("app",r.appId).get().then(function(r){e.currentApp=r,o.currentApp=r})}]),app.controller("AppEditController",function(){}),app.controller("AppDeleteController",["$scope","$state","Restangular","FormioAlerts",function(e,o,r,t){e.deleteApp=function(){e.currentApp&&e.currentApp._id&&r.one("app",e.currentApp._id).remove().then(function(){t.addAlert({type:"success",message:"Application was deleted!"}),o.go("home")},t.onError.bind(t))}}]),angular.module("formioApp.controllers",["formioApp.controllers.resource","formioApp.controllers.app","formioApp.controllers.user","formioApp.controllers.import","formioApp.controllers.help"]).config(["ResourceProvider",function(e){e.register({title:"Form",name:"form",url:"/form",views:{create:"views/form/form.html",edit:"views/form/form.html"}}),e.register({title:"Resource",name:"resource",url:"/resource",views:{create:"views/resource/resource.html",edit:"views/resource/resource.html"}})}]);var app=angular.module("formioApp.controllers.help",[]);app.controller("HelpIndexController",["$scope","$rootScope",function(e,o){o.activeSideBar="help",o.noBreadcrumb=!0}]);var app=angular.module("formioApp.controllers.import",[]);app.controller("ImportExportController",["$scope","$rootScope",function(e,o){o.activeSideBar="import",o.noBreadcrumb=!0}]);var app=angular.module("formioApp.controllers.resource",["ngDialog","ui.sortable","ui.bootstrap.tabs","ui.bootstrap.tpls","ui.bootstrap.accordion","ngFormBuilder","formio","bgf.paginateAnything"]);app.provider("Resource",["$stateProvider","RestangularProvider",function(e,o){var r={};return o.setRestangularFields({id:"_id"}),{register:function(o){var t=" resource-title=\"'"+o.title+"'\"";t+=" resource-name=\"'"+o.name+"'\"",r[o.name]=o;var n="app."+o.name;e.state(n,{"abstract":!0,url:o.url+"/:id",parent:"app",templateUrl:"views/resource/resource-root.html",controller:"ResourceController",params:{resourceInfo:o}}).state(n+".view",{url:"",parent:n,templateUrl:"views/resource/resource-view.html",controller:"ResourceViewController"}).state(n+".edit",{url:"/edit",parent:n,templateUrl:"views/resource/resource-edit.html"}).state(n+".delete",{url:"/delete",parent:n,templateUrl:"views/resource/resource-delete.html",controller:"ResourceDeleteController"}).state(n+".create",{url:"/create/"+o.name,parent:"app",templateUrl:"views/resource/resource-create.html",controller:"ResourceController",params:{resourceInfo:o}}).state(n+".index",{url:o.url,parent:"app",template:"<resource-list"+t+"></resource-list>"}).state(n+".api",{url:"/api",parent:n,templateUrl:"views/resource/resource-api.html",controller:"ResourceAPIController"}).state(n+".api.spec",{url:"/spec",parent:n+".api",templateUrl:"views/resource/resource-api.spec.html",controller:"ResourceAPISpecController"}).state(n+".api.embed",{url:"/embed",parent:n+".api",templateUrl:"views/resource/resource-api.embed.html"});var s={};s[n+".submission"]={path:"/submission",id:"subId",indexController:"ResourceSubmissionsController",itemController:"ResourceSubmissionController",editController:"ResourceSubmissionEditController",deleteController:"ResourceSubmissionDeleteController"},s[n+".action"]={path:"/action",id:"actionId",enabled:{view:!1},indexController:"ResourceActionIndexController",editController:"ResourceActionEditController",deleteController:"ResourceActionDeleteController"},angular.forEach(s,function(o,r){e.state(r,{"abstract":!0,url:o.path,parent:n,template:"<div ui-view></div>"}).state(r+".index",{url:"",parent:r,templateUrl:"views/resource"+o.path+"/index.html",controller:o.indexController}).state(r+".item",{"abstract":!0,url:"/:"+o.id,parent:r,controller:o.itemController,templateUrl:"views/resource"+o.path+"/item.html"}).state(r+".item.view",{url:"",parent:r+".item",templateUrl:"views/resource"+o.path+"/view.html",controller:o.viewController}).state(r+".item.edit",{url:"/edit",parent:r+".item",templateUrl:"views/resource"+o.path+"/edit.html",controller:o.editController}).state(r+".item.delete",{url:"/delete",parent:r+".item",templateUrl:"views/resource"+o.path+"/delete.html",controller:o.deleteController})}),e.state(n+".action.add",{url:"/add/:actionName",parent:n+".action",templateUrl:"views/resource/action/add.html",controller:"ResourceActionAddController",params:{actionInfo:null}})},$get:function(){return r}}}]),app.factory("FormioAlerts",["$rootScope",function(e){var o=[];return{addAlert:function(r){e.alerts.push(r),r.element?angular.element("#form-group-"+r.element).addClass("has-error"):o.push(r)},getAlerts:function(){var e=angular.copy(o);return o.length=0,o=[],e},onError:function(e){var o=e.hasOwnProperty("errors")?e.errors:e.data.errors;_.each(o,function(e){this.addAlert({type:"danger",message:e.message,element:e.path})}.bind(this))}}}]),app.directive("resourceList",function(){return{restrict:"E",replace:!0,templateUrl:"views/resource/resource-list.html",scope:{app:"=",resourceTitle:"=",resourceName:"=",numPerPage:"="},compile:function(e,o){o.numPerPage||(o.numPerPage=25),o.resourceTitle||(o.resourceTitle="Resource"),o.resourceName||(o.resourceName="resource")},controller:["$scope","$rootScope","Restangular",function(e,o,r){o.activeSideBar="apps",o.noBreadcrumb=!1,e.resources=[],e.resourcesPerPage=e.numPerPage,e.resourceUrl=r.one("app",e.app._id).all(e.resourceName).getRestangularUrl(),e.resourceInfo={title:e.resourceTitle,name:e.resourceName}}]}});var formioResourceScope=function(e,o,r,t,n){e.isActive=function(e){return-1!==o.current.name.indexOf(e)};var s=function(e){return e.toLowerCase().replace(/ (.)/g,function(e,o){return o.toUpperCase()})};e.appId=r.appId,e.resourceId=r.id,e.resourceName=r.resourceInfo.name,e.resourceUrl="/app/"+r.appId+"/"+r.resourceInfo.name,e.resourceUrl+=r.id?"/"+r.id:"",e.resourceInfo=r.resourceInfo,e.resource={title:"",components:[]},e.$watch("resource.title",function(){e.resource.name=e.resource.title?s(e.resource.title):""}),e.formio=new t(e.resourceUrl),e.formio.loadForm().then(function(o){e.resource=o}),e.saveResource=function(){e.formio.saveForm(e.resource).then(function(e){n.addAlert({type:"success",message:"Successfully created form!"}),o.go("app."+r.resourceInfo.name+".view",{id:e._id})},n.onError.bind(n))}};app.controller("ResourceController",["$scope","$state","$stateParams","Formio","FormioAlerts",formioResourceScope]),app.controller("ResourceViewController",["$scope","$state","FormioAlerts",function(e,o,r){e.$on("formSubmission",function(t,n){r.addAlert({type:"success",message:"New submission added!"}),o.go("app."+e.resourceInfo.name+".submission.item.view",{subId:n._id})})}]),app.controller("ResourceDeleteController",["$scope","$state","Formio","FormioAlerts",function(e,o,r,t){e.deleteResource=function(){e.formio.deleteForm().then(function(){t.addAlert({type:"success",message:"Delete successfull."}),o.go("app."+e.resourceInfo.name+".index")},t.onError.bind(t))}}]),app.controller("ResourceAPIController",["$scope","$state",function(e,o){o.transitionTo("app."+e.resourceInfo.name+".api.spec",{appId:e.appId,id:e.resourceId})}]),app.controller("ResourceAPISpecController",["$scope","AppConfig",function(e,o){e.getSwaggerURL=function(){return o.appBase+"/form/"+e.resource._id+"/spec.html"}}]),app.controller("ResourceActionIndexController",["$scope","$state","Formio","FormioAlerts",function(e,o,r,t){e.newAction={name:"",title:"Select an Action"},e.availableActions={},e.actions={},e.addAction=function(){e.newAction.name?o.go("app."+e.resourceInfo.name+".action.add",{actionName:e.newAction.name,actionInfo:e.newAction}):t.addAlert({type:"danger",message:"You must add an action to continue.",element:"action-select"})},e.formio.loadActions().then(function(o){e.actions=o},t.onError.bind(t)),e.formio.availableActions().then(function(o){o[0].name||o.shift(),o.unshift(e.newAction),e.availableActions=o})}]);var loadActionInfo=function(e,o,r){e.actionPath="",e.actionInfo=o.actionInfo||{settingsForm:{}},e.action={data:{settings:{}}};var t=function(o,r){e.formio.availableActions().then(function(t){angular.forEach(t,function(t){t.name===o&&(e.actionInfo=_.merge(e.actionInfo,t),r&&r(e.actionInfo))})})},n=function(n){if(o.actionId){e.actionPath=e.formio.formPath+"/action/"+o.actionId;var s=new r(e.actionPath);s.loadAction().then(function(o){e.action=_.merge(e.action,{data:o}),t(o.name)})}else n&&(e.action=_.merge(e.action,{data:n}),e.action.data.settings={})};!o.actionInfo&&o.actionName?t(o.actionName,function(e){n(e.defaults)}):n(e.actionInfo.defaults)};app.controller("ResourceActionAddController",["$scope","$stateParams","$state","FormioAlerts",function(e,o,r,t){loadActionInfo(e,o),e.$on("formSubmission",function(){t.addAlert({type:"success",message:"Action was created."}),r.go("app."+e.resourceInfo.name+".action.index")})}]),app.controller("ResourceActionEditController",["$scope","$stateParams","$state","Formio","FormioAlerts",function(e,o,r,t,n){loadActionInfo(e,o,t),e.$on("formSubmission",function(){n.addAlert({type:"success",message:"Action was updated."}),r.go("app."+e.resourceInfo.name+".action.index")})}]),app.controller("ResourceActionDeleteController",["$scope","$stateParams","$state","FormioAlerts",function(e,o,r,t){e.actionPath=e.formio.formPath+"/action/"+o.actionId,e.$on("delete",function(){t.addAlert({type:"success",message:"Action was deleted."}),r.go("app."+e.resourceInfo.name+".action.index")})}]),app.controller("ResourceSubmissionsController",["$scope","$state",function(e,o){e.$on("submissionView",function(r,t){o.go("app."+e.resourceInfo.name+".submission.item.view",{subId:t._id})}),e.$on("submissionEdit",function(r,t){o.go("app."+e.resourceInfo.name+".submission.item.edit",{subId:t._id})}),e.$on("submissionDelete",function(r,t){o.go("app."+e.resourceInfo.name+".submission.item.delete",{subId:t._id})})}]),app.controller("ResourceSubmissionController",["$scope","$state","$stateParams","Formio",function(e,o,r,t){e.submissionId=r.subId,e.submissionUrl=e.resourceUrl,e.submissionUrl+=r.subId?"/submission/"+r.subId:"",e.submissionData=t.submissionData,e.submission={},e.formio=new t(e.submissionUrl),e.formio.loadSubmission().then(function(o){e.submission=o})}]),app.controller("ResourceSubmissionEditController",["$scope","$state","FormioAlerts",function(e,o,r){e.$on("formSubmission",function(t,n){var s="put"===n.method?"updated":"created";r.addAlert({type:"success",message:"Submission was "+s+"."}),o.go("app."+e.resourceInfo.name+".submission.index",{id:e.resourceId})}),e.deleteSubmission=function(){e.formio.deleteSubmission().then(function(){o.go("app."+e.resourceInfo.name+".submission.index",{id:e.resourceId})},r.onError.bind(r))}}]),app.controller("ResourceSubmissionDeleteController",["$scope","$state","FormioAlerts",function(e,o,r){e.$on("delete",function(){r.addAlert({type:"success",message:"Submission was deleted."}),o.go("app."+e.resourceInfo.name+".submission.index")}),e.$on("cancel",function(){o.go("app."+e.resourceInfo.name+".submission.item.view")}),e.$on("formError",function(e,o){r.onError(o)})}]);var app=angular.module("formioApp.controllers.user",[]);app.controller("UserIndexController",["$scope","$rootScope",function(e,o){o.activeSideBar="user",o.noBreadcrumb=!0}]),angular.module("formioApp.directives",[]).directive("logo",function(){return{restrict:"E",scope:{size:"@"},templateUrl:"views/partials/logo.html"}}),angular.module("formioApp.services",[]).service("popupService",["$window",function(e){this.showPopup=function(o){return e.confirm(o)}}]);